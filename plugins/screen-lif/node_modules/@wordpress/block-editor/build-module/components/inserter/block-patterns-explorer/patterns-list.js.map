{"version":3,"names":["useMemo","useEffect","useRef","useState","_n","sprintf","useDebounce","__experimentalHeading","Heading","speak","BlockPatternsList","useInsertionPoint","usePatternsState","InserterListbox","searchItems","BlockPatternsPaging","usePatternsPaging","allPatternsCategory","isPatternFiltered","BlockPatternsSyncFilter","PATTERN_TYPES","PATTERN_SOURCE_FILTERS","PatternsListHeader","filterValue","filteredBlockPatternsLength","selectedCategory","patternCategories","filter","name","category","find","patternCategory","label","createElement","level","lineHeight","className","PatternList","searchValue","patternSourceFilter","patternSyncFilter","setPatternSyncFilter","container","debouncedSpeak","destinationRootClientId","onInsertBlocks","shouldFocusBlock","patterns","onClickPattern","registeredPatternCategories","map","filteredBlockPatterns","filteredPatterns","pattern","hasKnownCategory","categories","some","includes","length","count","resultsFoundMessage","pagingProps","hasItems","ref","user","shownPatterns","categoryPatternsAsyncList","blockPatterns","categoryPatterns","isDraggable","numPages"],"sources":["@wordpress/block-editor/src/components/inserter/block-patterns-explorer/patterns-list.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useMemo, useEffect, useRef, useState } from '@wordpress/element';\nimport { _n, sprintf } from '@wordpress/i18n';\nimport { useDebounce } from '@wordpress/compose';\nimport { __experimentalHeading as Heading } from '@wordpress/components';\nimport { speak } from '@wordpress/a11y';\n\n/**\n * Internal dependencies\n */\nimport BlockPatternsList from '../../block-patterns-list';\nimport useInsertionPoint from '../hooks/use-insertion-point';\nimport usePatternsState from '../hooks/use-patterns-state';\nimport InserterListbox from '../../inserter-listbox';\nimport { searchItems } from '../search-items';\nimport BlockPatternsPaging from '../../block-patterns-paging';\nimport usePatternsPaging from '../hooks/use-patterns-paging';\nimport { allPatternsCategory, isPatternFiltered } from '../block-patterns-tab';\nimport { BlockPatternsSyncFilter } from '../block-patterns-sync-filter';\nimport {\n\tPATTERN_TYPES,\n\tPATTERN_SOURCE_FILTERS,\n} from '../block-patterns-source-filter';\n\nfunction PatternsListHeader( {\n\tfilterValue,\n\tfilteredBlockPatternsLength,\n\tselectedCategory,\n\tpatternCategories,\n} ) {\n\tif ( ! filterValue ) {\n\t\treturn null;\n\t}\n\tlet filter = filterValue;\n\tif ( selectedCategory !== allPatternsCategory.name ) {\n\t\tconst category = patternCategories.find(\n\t\t\t( patternCategory ) => patternCategory.name === selectedCategory\n\t\t);\n\t\tif ( category ) {\n\t\t\tfilter = `${ filter } - ${ category?.label }`;\n\t\t}\n\t}\n\treturn (\n\t\t<Heading\n\t\t\tlevel={ 2 }\n\t\t\tlineHeight={ '48px' }\n\t\t\tclassName=\"block-editor-block-patterns-explorer__search-results-count\"\n\t\t>\n\t\t\t{ sprintf(\n\t\t\t\t/* translators: %d: number of patterns. %s: block pattern search query */\n\t\t\t\t_n(\n\t\t\t\t\t'%1$d pattern found for \"%2$s\"',\n\t\t\t\t\t'%1$d patterns found for \"%2$s\"',\n\t\t\t\t\tfilteredBlockPatternsLength\n\t\t\t\t),\n\t\t\t\tfilteredBlockPatternsLength,\n\t\t\t\tfilter\n\t\t\t) }\n\t\t</Heading>\n\t);\n}\n\nfunction PatternList( {\n\tsearchValue,\n\tpatternSourceFilter,\n\tselectedCategory,\n\tpatternCategories,\n} ) {\n\tconst [ patternSyncFilter, setPatternSyncFilter ] = useState( 'all' );\n\tconst container = useRef();\n\tconst debouncedSpeak = useDebounce( speak, 500 );\n\tconst [ destinationRootClientId, onInsertBlocks ] = useInsertionPoint( {\n\t\tshouldFocusBlock: true,\n\t} );\n\tconst [ patterns, , onClickPattern ] = usePatternsState(\n\t\tonInsertBlocks,\n\t\tdestinationRootClientId\n\t);\n\n\tconst registeredPatternCategories = useMemo(\n\t\t() =>\n\t\t\tpatternCategories.map(\n\t\t\t\t( patternCategory ) => patternCategory.name\n\t\t\t),\n\t\t[ patternCategories ]\n\t);\n\n\tconst filteredBlockPatterns = useMemo( () => {\n\t\tconst filteredPatterns = patterns.filter( ( pattern ) => {\n\t\t\tif (\n\t\t\t\tisPatternFiltered(\n\t\t\t\t\tpattern,\n\t\t\t\t\tpatternSourceFilter,\n\t\t\t\t\tpatternSyncFilter\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif ( selectedCategory === allPatternsCategory.name ) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif ( selectedCategory === 'uncategorized' ) {\n\t\t\t\tconst hasKnownCategory = pattern.categories.some(\n\t\t\t\t\t( category ) =>\n\t\t\t\t\t\tregisteredPatternCategories.includes( category )\n\t\t\t\t);\n\n\t\t\t\treturn ! pattern.categories?.length || ! hasKnownCategory;\n\t\t\t}\n\n\t\t\treturn pattern.categories?.includes( selectedCategory );\n\t\t} );\n\n\t\tif ( ! searchValue ) {\n\t\t\treturn filteredPatterns;\n\t\t}\n\n\t\treturn searchItems(\n\t\t\tfilteredPatterns,\n\t\t\tsearchValue,\n\t\t\tpatternSourceFilter\n\t\t);\n\t}, [\n\t\tsearchValue,\n\t\tpatternSourceFilter,\n\t\tpatterns,\n\t\tselectedCategory,\n\t\tregisteredPatternCategories,\n\t\tpatternSyncFilter,\n\t] );\n\n\t// Announce search results on change.\n\tuseEffect( () => {\n\t\tif ( ! searchValue ) {\n\t\t\treturn;\n\t\t}\n\t\tconst count = filteredBlockPatterns.length;\n\t\tconst resultsFoundMessage = sprintf(\n\t\t\t/* translators: %d: number of results. */\n\t\t\t_n( '%d result found.', '%d results found.', count ),\n\t\t\tcount\n\t\t);\n\t\tdebouncedSpeak( resultsFoundMessage );\n\t}, [ searchValue, debouncedSpeak, filteredBlockPatterns.length ] );\n\n\tconst pagingProps = usePatternsPaging(\n\t\tfilteredBlockPatterns,\n\t\tselectedCategory,\n\t\tcontainer,\n\t\tpatternSourceFilter\n\t);\n\n\tconst hasItems = !! filteredBlockPatterns?.length;\n\treturn (\n\t\t<div\n\t\t\tclassName=\"block-editor-block-patterns-explorer__list\"\n\t\t\tref={ container }\n\t\t>\n\t\t\t<PatternsListHeader\n\t\t\t\tfilterValue={\n\t\t\t\t\tsearchValue || PATTERN_SOURCE_FILTERS[ patternSourceFilter ]\n\t\t\t\t}\n\t\t\t\tfilteredBlockPatternsLength={ filteredBlockPatterns.length }\n\t\t\t\tselectedCategory={ selectedCategory }\n\t\t\t\tpatternCategories={ patternCategories }\n\t\t\t/>\n\n\t\t\t<InserterListbox>\n\t\t\t\t{ patternSourceFilter === PATTERN_TYPES.user &&\n\t\t\t\t\t! searchValue && (\n\t\t\t\t\t\t<BlockPatternsSyncFilter\n\t\t\t\t\t\t\tpatternSyncFilter={ patternSyncFilter }\n\t\t\t\t\t\t\tsetPatternSyncFilter={ setPatternSyncFilter }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\n\t\t\t\t{ hasItems && (\n\t\t\t\t\t<BlockPatternsList\n\t\t\t\t\t\tshownPatterns={ pagingProps.categoryPatternsAsyncList }\n\t\t\t\t\t\tblockPatterns={ pagingProps.categoryPatterns }\n\t\t\t\t\t\tonClickPattern={ onClickPattern }\n\t\t\t\t\t\tisDraggable={ false }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t{ pagingProps.numPages > 1 && (\n\t\t\t\t\t<BlockPatternsPaging { ...pagingProps } />\n\t\t\t\t) }\n\t\t\t</InserterListbox>\n\t\t</div>\n\t);\n}\n\nexport default PatternList;\n"],"mappings":"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"}